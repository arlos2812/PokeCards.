<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PokeCards</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0b0b0b">

  <!-- ESTILOS -->
  <link rel="stylesheet" href="style.css">
</head>

<body>

<header>
  <h1 class="logo">PokeCards</h1>
  <button id="favorites-btn">â­ Favoritas</button>
</header>

<!-- MÃšSICA -->
<div class="music-bar">
  <button id="music-toggle">â–¶ï¸ MÃºsica</button>
  <input id="music-volume" type="range" min="0" max="1" step="0.01" value="0.4">
</div>

<!-- ESCANEO -->
<div class="scan-bar">
  <button id="scan-btn">ğŸ“· Escanear carta</button>
  <input id="camera-input" type="file" accept="image/*" capture="environment" style="display:none">
</div>

<!-- LOADER -->
<div id="global-loading" class="loading hidden">
  <div class="spinner"></div>
  <div id="loading-text">Cargandoâ€¦</div>
</div>

<!-- EXPANSIONES -->
<section id="sets-screen">
  <h2 class="section-title">EXPANSIONES</h2>
  <div id="sets" class="grid"></div>
</section>

<!-- CARTAS -->
<section id="cards-screen" class="hidden">
  <button id="back-to-sets">â¬… Volver</button>

  <select id="filter">
    <option value="az">Aâ€“Z</option>
    <option value="za">Zâ€“A</option>
    <option value="price-desc">ğŸ’° Precio â†“</option>
    <option value="price-asc">ğŸ’° Precio â†‘</option>
  </select>

  <!-- ğŸ”¹ AQUÃ IRÃ EL RESUMEN DE EXPANSIÃ“N -->
  <div id="set-summary"></div>

  <h2 id="set-title" class="section-title"></h2>
  <div id="cards" class="grid"></div>
</section>

<!-- FAVORITAS -->
<section id="favorites-screen" class="hidden">
  <button id="back-from-favorites">â¬… Volver</button>
  <h2 class="section-title">â­ Mis Favoritas</h2>
  <div id="favorites" class="grid"></div>
  <p id="no-favorites" class="hidden">No tienes cartas favoritas todavÃ­a â­</p>
</section>

<!-- FICHA -->
<section id="card-screen" class="hidden">
  <button id="back-to-cards">â¬… Volver</button>
  <div id="card-detail"></div>
</section>

<!-- AVISO NUEVA VERSIÃ“N -->
<div id="update-banner" class="hidden" style="
  position:fixed;
  bottom:12px;
  left:12px;
  right:12px;
  background:#1c1c1c;
  border-radius:12px;
  padding:12px;
  text-align:center;
  z-index:999;
">
  ğŸ”” Nueva versiÃ³n disponible<br><br>
  <button id="update-btn">Actualizar ahora</button>
</div>

<audio id="music-player"></audio>

<script src="app.js"></script>

<!-- SERVICE WORKER + AVISO -->
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("service-worker.js");
  });

  navigator.serviceWorker.addEventListener("controllerchange", () => {
    window.location.reload();
  });

  navigator.serviceWorker.ready.then(reg => {
    if (reg.waiting) showUpdateBanner(reg);

    reg.addEventListener("updatefound", () => {
      const newWorker = reg.installing;
      newWorker.addEventListener("statechange", () => {
        if (newWorker.state === "installed" && navigator.serviceWorker.controller) {
          showUpdateBanner(reg);
        }
      });
    });
  });

  function showUpdateBanner(reg) {
    const banner = document.getElementById("update-banner");
    const btn = document.getElementById("update-btn");
    banner.classList.remove("hidden");
    btn.onclick = () => reg.waiting.postMessage("SKIP_WAITING");
  }
}
</script>

</body>
</html>
